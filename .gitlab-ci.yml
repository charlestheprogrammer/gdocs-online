stages:
  - lint ğŸ’„
  - test ğŸ§ª
  - deploy ğŸš€

lint:
  stage: lint ğŸ’„
  image: node:20.0.0-alpine
  script:
    - npx prettier -c ./frontend/**/*.js ./frontend/**/*.html
    - npx prettier -c ./backend/**/*.js

test:
  stage: test ğŸ§ª
  image: node:20.0.0-alpine
  script:
    - npm install --prefix ./backend
    - npm run test --prefix ./backend

deploy_to_s3:
  stage: deploy ğŸš€
  image: registry.gitlab.com/gitlab-org/cloud-deploy/aws-base:latest
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
  script:
    - aws s3 sync frontend/ s3://nlpf-frontend-website --delete
